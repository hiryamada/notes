# 管理グループ

**※注意: 管理グループ自体はAzure ADの機能ではなく、Azureのサブスクリプション管理機能。ただしAzure ADテナントとの関連がいくつかある**

https://docs.microsoft.com/ja-jp/azure/governance/management-groups/overview


- 「管理グループ」と呼ばれるコンテナーにサブスクリプションを整理することができる。
- 複数のサブスクリプションに対するロールやポリシーの設定をまとめることができる

```
ルート管理グループ
└管理グループ1
  ├サブスクリプション1
  └サブスクリプション2
```

- 最上位には「ルート管理グループ(Tenant root group)」が存在する
  - 移動・削除ができない
- 管理グループは6段まで階層構造にできる

```
ルート管理グループ
└管理グループ1
  └管理グループ2
    └管理グループ3
      └管理グループ4
        └管理グループ5
          └管理グループ6
```


■Azure ADテナントとの関係

※信頼: テナントとサブスクリプションの結びつきのこと。サブスクリプションは、1つのテナントを信頼する。

```
テナント1
└サブスクリプション1 (テナント1を信頼)
```

複数のサブスクリプションが、1つのテナントを信頼することができる（テナントは複数のサブスクリプションを「持つ」）

```
テナント1
├サブスクリプション1 (テナント1を信頼)
└サブスクリプション2 (テナント1を信頼)
```

単一の管理グループ内のすべてのサブスクリプションは、同じ Azure Active Directory テナントを信頼する必要がある。

```
テナント1
└ルート管理グループ
 └サブスクリプション1

テナント2
└ルート管理グループ
 └サブスクリプション2
```

テナント1のサブスクリプションとテナント2のサブスクリプションを1つの管理グループに入れることはできない。

■初期状態

```
ルート管理グループ
└ サブスクリプション
```
■管理グループ「mg1」を作成

```
ルート管理グループ
├ mg1
└ サブスクリプション
```

■サブスクリプションを「mg1」に移動

```
ルート管理グループ
└ mg1
  └ サブスクリプション
```

■4種類の「スコープ」

各スコープで、ロールやポリシーを割り当てることができる。割り当ては下位のスコープに継承される。

```
管理グループ
└ サブスクリプション
  └ リソースグループ
    └ リソース
```

■昇格

https://docs.microsoft.com/ja-jp/azure/role-based-access-control/elevate-access-global-admin

- Azure AD の全体管理者（グローバル管理者）には、テナントのすべてのサブスクリプションと管理グループにアクセスする権限が与えられていない場合がある。
- Azure AD の全体管理者は、自分自身を「昇格」できる。
- 「昇格」を行うと、その管理者に、ルート管理グループのレベルで、[ユーザーアクセス管理者ロール（User Access Administrator）](https://docs.microsoft.com/ja-jp/azure/role-based-access-control/built-in-roles#user-access-administrator)が割り当てされる。


例: テナントにuser1, user2を作り、user1にグローバル管理者に設定した場合
```
Azure ADテナント
│ ├user1=グローバル管理者
│ └user2
└ルート管理グループ
 └Azure サブスクリプション

↓ user1が自分自身を「昇格」

Azure ADテナント
│ ├グローバル管理者 user1
│ └user2
└ルート管理グループ user1=ユーザーアクセス管理者
 └Azure サブスクリプション

↓ user1がuser2をサブスクリプションの共同作成者(Contributor)に割り当て

Azure ADテナント
│ ├グローバル管理者 user1
│ └user2
└ルート管理グループ user1=ユーザーアクセス管理者
 └Azure サブスクリプション user2=共同作成者
```

