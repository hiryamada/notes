# ラボ11 

「SQL Server」の中に、「SQLデータベース」があります。

- タスク1
  - ARMテンプレートを使用してSQL ServerとSQLデータベースをデプロイします。
- タスク2
  - [Azure Defender for SQL](https://docs.microsoft.com/ja-jp/azure/azure-sql/database/azure-defender-for-sql)を、サブスクリプションレベルで有効化します。
    - この操作は「セキュリティセンター」から行います。
    - サブスクリプションに含まれるSQL Serverが、Azure Defender for SQLで保護されます
    - Azure Defender for SQLの機能
      - 脆弱性評価: 潜在的な脆弱性（ベストプラクティスに則っていない設定）を検出
      - Advanced Threat Protection(ATP): SQLインジェクション攻撃などを検出
- タスク3 
  - データベースのテーブルの、個人情報などが入力されている列を自動的に検出します。
  - 検出した列に「機密ラベル」を付けます。
- タスク4 
  - サーバーで、監査を有効化します。
  - 監査ログの保存先としてストレージアカウントを設定します。
  - サーバーの監査レコードとデータベースの監査レコードの表示方法を確認します。
    - 実際の監査レコードは、このラボでは確認できません。

## 演習1

タスク1-6 場所 (US) East US → (US) 米国東部

タスク1-7 デプロイ完了まで3分ほどかかります。

タスク2-3 リソース グループでは、「SQL Server」と、「SQLデータベース」の2つのリソースが確認できます。「SQL Server」をクリックします。

タスク2-4 Security Center → セキュリティセンター

タスク2-5 「アップグレード」をクリックします。「エージェントのインストール」をクリックします。

タスク2-6 ～ 2-8 これらの表示が確認できるまで、少し時間がかかります。タスク3以降を実施してから、後ほど戻って実施してください。タスク2-6 ～ 2-8で特に設定を変更する箇所はありません。

タスク2-6 SQL Serverの「セキュリティ」セクションの「セキュリティセンター」をクリックします。「Azure Defender for SQL: サブスクリプションレベルで有効 (構成)」の「構成」をクリックします。

タスク2-7 「価格と試用期間」は、青いビックリマークアイコンの部分に表示されています。「脆弱性評価の設定」は、その下に表示されています。「高度な脅威保護設定」→「ADVANCED THREAT PROTECTION 設定」

タスク2-8 SQL Serverの「セキュリティ」セクションの「セキュリティセンター」をクリックします。画面右側に、「推奨事項」「セキュリティ警告」「調査結果」などの表示を確認します。

タスク3-6 リストされた列と推奨される秘密度ラベルを確認します。 → 「テーブル」、「列」、「情報の種類」、「機密ラベル」を確認します。テーブルのこれらの列に、Name（個人名）、Contact Info（連絡先）、Credentials（パスワードなど）、Finalcial（口座番号）、Credit Card（クレジットカード番号）などの情報が格納されていることが検出されます。

タスク4-4 「構成」 をクリックします。 → 「新規作成」をクリックします。

タスク4-5 スキップします。


タスク4-7 「ストレージの設定」 ブレードに戻り、「保存期間 (日)」 を 「5」 に設定し、「OK」 をクリックします。 → ストレージアカウント「新規作成」ボタンの下の「詳細プロパティ」をクリックして展開します。「保有日数」を5日にします。「OK」ボタンはありません。

タスク4-8 「監査」 ブレードに戻り、「保存」 をクリックして監査の設定を保存します。→ ブレード（画面）の移動はありません。画面上部の「保存」をクリックします。


