# ラボ4a（MFA）

想定時間: 60min

ラボ4の演習1, 2の手順を実施します。

[ラボの手順書](https://microsoftlearning.github.io/AZ-500JA-AzureSecurityTechnologies/)の「04 - MFA、条件付きアクセス、AAD ID 保護」を見ながら実施します。また、本ページの補足事項も合わせてご確認ください。

また、スマートフォン（携帯電話）をご準備ください。
- Microsoft Authenticatorアプリをセットアップしておきます
- 電話番号（SMSを受信します）

（まだ準備していない場合は）事前に[ラボのファイル](https://github.com/MicrosoftLearning/AZ-500JA-AzureSecurityTechnologies/archive/master.zip)をダウンロードして展開しておきましょう。

注意：ラボで指定されていないユーザー（自分自身）のMFA設定を変更しないでください。設定を誤ると、最悪の場合、自分自身を締め出してしまい、サブスクリプションが利用できなくなってしまいます。

## ラボの重要ポイント

- 演習1 
  - ARMテンプレートを使い、VMをデプロイします。
  - このVMは次のラボ（ラボ4b）で使用します。
- 演習2 (MFA) 
  - 検証用のテナントを作ります
  - Azure AD Premium P2試用版を有効化します。
  - ユーザーを作り、Premium P2ライセンスを割り当てます。
  - 組織のMFAの設定を行い、ユーザーのMFAを有効化します。
  - ユーザーのサインインと、初期MFAセットアップを実行します。

演習2で作成したユーザーやテナントはラボ5でも使用します。

# 事前準備

- 演習1で使用するファイル: [ラボの目次ページ](https://microsoftlearning.github.io/AZ-500JA-AzureSecurityTechnologies/)上部の「こちらからダウンロードできます」をクリックしてZIPファイルをダウンロードし、展開しておきます。
- 手順書と実際の画面の文言が異なる場合があります。実際の画面の表示をよく読んで操作を進めてください。

## 補足事項

### 演習1

タスク1-9 リージョン:「米国東部」を選択します。管理者ユーザー名(Admin Username)、管理者のパスワード（Admin Password): 変更する必要はありません. ユーザー名は `Student` 、パスワードは `Pa55w.rd1234` となります

タスク1-10 レビューと作成 → 確認と作成

### 演習2

タスク1-4 初期ドメイン名: adatum9238748237 といったような、adatum+ランダムな数値とします。数値の部分はキーボードを適当に打つなどして生成してください。
初期ドメイン名を入力後、その下に表示される、
adatum9238748237.onmicrosoft.com
といった文字列をコピーしてメモ帳などに貼り付けて記録しておきます。

タスク1-5 レビューと作成 → 確認と作成

タスク3-3 ロール: 「役割」のところに表示されている「ユーザー」をクリックします。「ディレクトリ ロール」で「グローバル管理者」にチェックを入れます（「グローバル閲覧者」にチェックしないように注意）。「選択」をクリックします。

利用場所: 米国 → United Statesを選びます

手順書に「完全なユーザー名を記録します」とあります。作成したaaduser1をクリックすると、aaduser1の下（アイコンの上）に太字で「aaduser1@adatum9238748237.onmicrosoft.com」といった、初期ドメインが付いたユーザー名が表示されます。これが「完全なユーザー名」（正確にはUPN）です。これをコピーしてメモ帳などに貼り付けて記録しておきます。

タスク3-5,タスク3-7 ロール: 「役割」のところに表示されている「ユーザー」をそのまま使います。変更（選択）する必要はありません。

タスク4-1 「ユーザー アカウントを表すエントリをクリックします。」→aaduser1/2/3以外の、最初から登録されているユーザー(Microsoftアカウントの名前が付いています)をクリックします。

タスク4-3 「米国」 エントリを選択→ United States

タスク4-6 「ライセンスの割り当て」 ブレードで、「ユーザー」 をクリックします。→「+ Add users and groups」リンクをクリックします。

タスク4-7 「ユーザー」」 ブレードで、 aaduser1、aaduser2、 aaduser3、およびユーザー アカウントを選択 →aaduser1/2/3と、最初から登録されているユーザー(Microsoftアカウントの名前が付いています)を選択します。

タスク4-8 すべてのオプションが有効になっていることを確認して、「OK」 をクリックします。 → 4つのスイッチが「オン」担っていることを確認します（変更しません）。「Review + Assign」をクリックします。

タスク5-3 「多要素認証 | はじめに」 ブレードで、「追加のクラウド ベース MFA 設定」 リンクをクリックします。 →このブレードやリンクが見つからない場合は、Webブラウザで、ページをリロードします。

タスク5-5 多要素認証ページで、「サービス設定」 タブをクリックします。→ページ上部の「多要素認証」タイトルの下に、「ユーザー」と「サービス設定」が表示されています。「サービス設定」をクリックします。（初期状態で「サービス設定」が選択されているため、とくに表示は変わりません）

タスク5-5「保存」 をクリックしてから、「閉じる」 をクリックします。→ この操作は不要です。 ページ中程に表示されている「検証オプション」を確認しますが、ここのチェックボックスを変更する必要はありません。

タスク5-6 「ユーザー」 タブに切り替えて→ページ上部の「多要素認証」タイトルの下に、「ユーザー」と「サービス設定」が表示されています。「ユーザー」をクリックします。

タスク5-6 「有効」 リンクをクリックします。→画面右側に表示される「有効にする」をクリックします。

タスク5-8 aaduser1 をクリックすると、この時点で 「強制」 オプションも表示されます。→ここは特に「強制」をクリックする必要はありません。

タスク5-14 「セキュリティのデフォルトの管理」 リンクをクリック →「セキュリティの既定値群の管理」をクリックします。

タスク6-1 InPrivate ブラウザーの画面を開きます。→WebブラウザでCtrl + Shift + N を押して、InPrivateウィンドウ（ブラウザによっては「シークレットウィンドウ」「プライベートウィンドウ」等）を開きます。

現在すでに InPrivateウィンドウを使用している場合は、いったんすべてのブラウザウィンドウを閉じてください。（複数のInPrivateウィンドウを立ち上げても、セッションは共通のものが利用されてしまいます）

タスク6-2 Azure portalに移動 → https://portal.azure.com/ にアクセスします。

タスク6-4 ～ 6-8 「アプリ」と「電話」の2つのメソッドの設定が求められます。画面の表示に従って設定を完了させてください。

- 「1. アプリ」: Microsoft Authenticatorアプリの案内が出ますので、お手元のスマートフォンにアプリをインストールして、セットアップを完了してください。
  - Microsoft Authenticatorアプリの右上の「＋」をタップ
  - 「アカウントを追加」で「職場または学校のアカウント」をタップ
  - 「QRコードをスキャン」をタップ
  - 画面に表示されたQRコードをスキャン
  - サインインの通知を承認する
- 「2. 電話」: 
  - 「Japan（＋81）」を選択
  - 電話番号を入力。080 / 090 の場合、先頭の0を省いて 80 / 90 から入力します。
  - 入力した電話番号あてに確認コードが送られてきます
  - 確認コードを画面のテキストボックスに入力します。

※このラボの手順は以上です。演習3以降は、[次のラボ（ラボ4b）](lab04b-idp.md)で実施します。クリーンナップ等はこのラボでは実施する必要はありません。

