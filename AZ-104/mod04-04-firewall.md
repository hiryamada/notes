# [Azure Firewall](https://docs.microsoft.com/ja-jp/azure/firewall/overview)

[解説PDF](pdf/mod04/Azure%20Firewall.pdf)

Azure Firewall は、クラウドネイティブのサービスとしてのファイアウォール (FWaaS) オファリングです。

お客様のすべてのトラフィック フローを一元的に管理し、ログに記録することができます。

アプリケーションおよびネットワークの両レベルのフィルタリング規則がサポートされています。

Microsoft 脅威インテリジェンスのフィードと統合されていて、既知の悪意のある IP アドレスおよびドメインをフィルタリングすることができます。

参考: [Announcement Blob](https://azure.microsoft.com/ja-jp/blog/azure-firewall-and-network-virtual-appliances/)

# 脅威インテリジェンス

脅威インテリジェンス ベースのフィルタリングを有効にして、悪意のある既知の IP アドレスおよびドメインとの間のトラフィックをファイアウォールによって警告およびブロックできます。

IP アドレスとドメインの情報は Microsoft 脅威インテリジェンス フィードから取得され、最も信頼度の高いレコードのみが含まれます。

3 つの設定の中から選択できます。

- オフ - この機能はご使用のファイアウォールでは有効になりません。
- 警告のみ - 悪意のある既知の IP アドレスおよびドメインと通信するトラフィックがファイアウォールを通過すると、信頼度の高い警告を受信します
- 警告して拒否 - 悪意のある既知の IP アドレスおよびドメインと通信するトラフィックがファイアウォールを通過すると、トラフィックがブロックされ、信頼度の高い警告を受信します

```
インターネット上のクライアント
（「脅威インテリジェンス」により危険と判断されたIPアドレス/ドメイン）
↓
パブリックIPアドレス
↓
Azure Firewall ... 脅威インテリジェンス ベース フィルター
↓
VM
```

# 送信元ネットワーク アドレス変換 (SNAT) 

仮想ネットワーク トラフィックから、インターネットへのアウトバウンドトラフィックでは、送信元 IP アドレスは Azure Firewall のパブリック IP アドレスに変換されます。 

```
インターネット上のサーバ等
↑
パブリックIPアドレス ... a.b.c.d
↑
Azure Firewall ... SNAT
↑
VM ... 10.0.0.0/16
```

# 宛先ネットワーク アドレス変換 (DNAT) 

インターネットから、ファイアウォールのパブリック IP アドレスへのインバウンド インターネット ネットワーク トラフィックでは、宛先IPアドレスは、仮想ネットワークのプライベート IP アドレスに変換されます。

```
インターネット上のクライアント等
↓
パブリックIPアドレス ... a.b.c.d
↓
Azure Firewall ... DNAT
↓
VM ... 10.0.0.0/16
```

# Azure Firewallのコスト

|-|料金|
|-|-|
|デプロイメント|デプロイ時間あたり ￥140|
|データ処理|処理 GB あたり ￥1.792|

1ヶ月(730時間)稼働させると、約10万円～
