# ラボ2a

想定時間: 30分

RBACロールのラボです。

事前に[ラボのファイル](https://github.com/MicrosoftLearning/AZ-104JA-MicrosoftAzureAdministrator/archive/master.zip)をダウンロードして展開しておきましょう。

## ラボの重要ポイント

- タスク1
  - 新しい管理グループを作成し、管理グループの下にサブスクリプションを移動（追加）します。これによって、サブスクリプションの管理を、管理グループ単位で実行することができるようになります。
  - このラボでは、1つのサブスクリプションだけを扱っているのであまり管理グループの必要性はありません。実際の業務での利用例としては、複数のサブスクリプションを1つの管理グループにまとめて、管理グループ単位でロール割り当てやポリシー割り当てを行う形となります。
- タスク2
  - Azureにはたくさんの組み込みのRBACロールがありますが、それらのロールに適切な権限セットのものがない場合、「カスタムRBACロール」を作成して、利用することができます。
  - ここでは「Support Request Contributor (Custom)」というカスタムRBACロールを定義します。
  - このロール定義内の「Actions」で、リソースグループの情報の読み取りと、Azureサポートの全機能が利用できる、というアクションを指定しています。
  - ロール定義内の「AssignableScopes」では、このロールを割り当てすることができるスコープ（管理グループやサブスクリプション）を指定します。
- タスク3
  - 新しいユーザー「az104-02-aaduser1」を作成します。
  - タスク2で作成したロールをこのユーザーに割り当てます。
  - 「az104-02-aaduser1」でサインインし、ロールのActionsで許可された操作が実行できることを確認します。



## 補足事項

事前に必要なファイルのダウンロードを行ってください。

お手元のブラウザでラボを実施する場合: [ラボファイル](https://github.com/MicrosoftLearning/AZ-104JA-MicrosoftAzureAdministrator/archive/master.zip)をダウンロードし、展開します。その中のAllFilesフォルダ以下に、ラボで使用するファイルが含まれています。

ラボ環境でラボを実施する場合: ラボ環境の中のブラウザを使用して、[ラボファイル](https://github.com/MicrosoftLearning/AZ-104JA-MicrosoftAzureAdministrator/archive/master.zip) をラボ環境の中にダウンロードし、展開します。その中のAllFilesフォルダ以下に、ラボで使用するファイルが含まれています。

タスク1の2
注のほう「管理グループの使用を開始します」をクリックで進めます。

タスク1の4
「更新」をクリックしてからaz104-02-mg1をクリック。
詳細ではなく、az104-02-mg1の右の「details」

タスク1の5
Azure Pass -スポンサープラン-のこと。

タスク3の4
一番下にあるはずです。
解像度によっては半分切れていて読めないかもしれません。
スクロールしてください。

タスク3の7
権限があれば、クラウドシェル用のストレージアカウント用RGが表示されます。
1回目表示されなければ、サインアウトして、再度確認してください。

タスク3の8
新しいサポート要求→新しいサポートリクエスト

リソースのクリーンアップ

3　Azure サブスクリプションを表すエントリの右側にある 「省略記号」 アイコンを右クリックし、「移動」 をクリックします。
→AzurePassの右の「・・・」をクリック、「移動」をクリック、
新しい親管理グループで、「Tenant Root Group」を選択して、「保存」

5 ロールの定義がされてから、Get-AzRoleAssignmentコマンドでそのロールの情報が取れるようになるまで、時間がかかるケースがあります。この場合、コマンドの実行に失敗します。ロールの定義をPortalから手動で削除してください。

「省略記号」 アイコン→「...」です。
