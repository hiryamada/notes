# ラボ2b

想定時間: 30分

Azure Policyのラボです。

[PDF資料](../pdf/mod02/ラボ2b補足.pdf)もぜひご確認ください。


## ラボの重要ポイント

- タスク1
  - **デフォルトでは、リソースグループのタグが、リソースに反映されない** ことを確認します。
    - ストレージ アカウント（モジュール7で解説します）が属するリソースグループに、「Role＝Infra」というタグを付けます。
    - ストレージ アカウントに、タグが付いていないことを確認します。
- タスク2
  - **「タグとその値がリソースに必要」ポリシー（Effect=Deny）を付けたリソースグループ以下には、タグを付けずにリソースを作成できない** ことを確認します。
    - 「タグとその値がリソースに必要」というポリシーをリソース グループに割り当てます。
    - このポリシーを割り当てたリソースグループに、タグを付けずに、ストレージアカウントを作ることを試します。
    - タグが付いていないので、ポリシーに違反し、ストレージアカウントの作成が失敗します。
- タスク3
  - **「存在しない場合は、リソース グループからタグを継承する」ポリシー（Effect=Modify）を付けたリソースグループ以下に、タグを付けずにリソースを作成すると、タグがリソースに継承される** ことを確認します。
    - 「存在しない場合は、リソース グループからタグを継承する」 というポリシーをリソースグループに割り当てます。
    - このポリシーを割り当てたリソースグループに、タグを付けずに、ストレージアカウントを作ります。
    - ポリシーの働きにより、上位のリソースグループのタグが継承されます。つまり、ストレージアカウントに、リソースグループと同じタグが追加されます。
- 参考
  - このラボでは「修復タスク」の動作までは確認しませんが、ここで「修復タスク」について説明します。
  - タスク3のポリシー割り当て時に「修復タスク」を作成しています。
  - この修復タスクの「修復状態」は、ポリシー割り当て直後は「評価中」となります。
  - しばらく（数十分）経つと、「修復状態」は「完了」となります。
  - **修復タスクが「完了」すると、タグが付いていなかったリソースに、タグ付けが行われます。**

## 補足事項

タスク1の5
リソースグループ名を表すリンク→リソースグループ：cloud-shell-storage-southeastasiaです。

タスク2の12
「MarketPlaceの検索」で検索せずに、人気順のところから探してください。

タスク2の14
検証に成功する場合は作成してみてください。作成には失敗すると思います。

## リソースのクリーンアップ

4　保存→適用

6　yesではなく、ストレージアカウント名を入力