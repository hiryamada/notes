# ラボ4

想定時間: 60分

（まだ準備していない場合）事前に[ラボのファイル](https://github.com/MicrosoftLearning/AZ-104JA-MicrosoftAzureAdministrator/archive/master.zip)をダウンロードして展開しておきましょう。


タスク1,2,3,4は、仮想ネットワーク(VNet)、サブネット、VMのネットワークインターフェースカード（NIC）、IPアドレス、ネットワークセキュリティグループといった、VNetの基本を学びます。

タスク5, 6は、Azure DNSの設定を学びます。

## ラボの重要ポイント

### VNetの基礎（タスク1～4）
- タスク1
  - VNetを作成します。同時に1つ目のサブネットも作られます。
  - 2つ目のサブネットをVNetに追加します。
- タスク2
  - テンプレートを使用して、VNetに2つのVMをデプロイします。
- タスク3
  - それぞれのVMのNICのIP構成で、以下を実施します。
    - プライベートIPアドレスの割り当てを「静的」に変更し、IPアドレスを固定します。
    - 新しいStandardのパブリックIPアドレスを作成して割り当てます。
- タスク4
  - NSGがない場合、StandardのパブリックIPアドレスを使用したリモートデスクチップ（RDP）接続が失敗することを確認します。
  - 新しいNSGを作成し、受信セキュリティ規則で、RDP接続を許可します。
  - 2つのNICにNSGを関連付けします。
  - RDP接続が成功します。（このRDP接続はタスク5で使用します）

### Azure DNS プライベートDNSゾーン（タスク5）
- タスク5
  - Azure DNSのプライベートDNSゾーン「consoso.org」を作成します。「自動登録」を有効化します。
  - タスク1で作成したVNetとゾーンをリンクします。
  - タスク2で作成した2つのVMが「az104-04-vm0.contoso.org」「az104-04-vm1.contoso.org」としてゾーンに自動登録されることを確認します。
  - vm0上で「nslookup az104-04-vm1.contoso.org」を実行し、vm1のプライベートIPアドレスに解決されることを確認します。

### Azure DNS パブリックDNSゾーン（タスク5）
- タスク6
  - Godaddy（ドメインレジストラの一種。なお、App Serviceのカスタムドメイン購入でも[内部的にGodaddyが使用](https://docs.microsoft.com/ja-jp/azure/app-service/manage-custom-dns-buy-domain)されます）を使用して、インターネットでまだ使われていないドメインを検索します。
  - このドメインを購入した、という想定で、続く作業を進めます。
  - パブリックのDNSゾーンを作成します。
  - vm0とvm1の名前とパブリックIPアドレスをそれぞれゾーンのAレコードとして設定します。
  - Cloud Shellを使用して、nslookupを実行し、vm0とvm1のパブリックIPアドレスに解決されることを確認します。
  - 解決するFQDNのドメイン名は、実際に取得したものではないため、インターネットのDNSを使用した名前解決はできません。したがって、ここでは、nslookupの第2引数で、パブリックのDNSゾーンの「ネームサーバー」のいずれかを指定して、そのネームサーバーで名前解決をするようにnslookupに指示する必要があります。

## 補足事項

タスク1の2
バーチャルネットワーク→仮想ネットワーク

タスク1の3
リージョン：東日本
IPv4アドレス空間：既存の10.0.0.0/16を変更して10.40.0.0/20にする

タスク4の8
Allow→許可

タスク5の4
「バーチャル ネットワーク リンク」→「仮想ネットワークリンク」

タスク5の8
Windows PowerSHell（管理者）→Windows PowerShell(admin)

タスク6の11

以下はドメインが「mydomain.com」、ネームサーバーが「ns1-02.azure-dns.com.」の場合の例です。

```
nslookup az104-04-vm0.mydomain.com ns1-02.azure-dns.com.
```

コマンドと引数の間にスペースを入れることに注意してください。
