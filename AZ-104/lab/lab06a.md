# ラボ6a

想定時間: 60分

3つのVNetを使用して、ハブ・スポークのネットワークを作ります。

ハブ（中央）のVNetのVMをルーターとして構成することで、ハブのルーターを経由して、スポークのVM同士が通信できることを確認します。

[ラボ6手順書](https://github.com/MicrosoftLearning/AZ-104JA-MicrosoftAzureAdministrator/blob/master/Instructions/Labs/LAB_06-Implement_Network_Traffic_Management.md)の、タスク1～4を実施します。

タスク5～タスク6は、[次のラボ](lab06b.md)で実施しますので、スキップしてください。


## ラボの重要ポイント

- タスク1-2
  - 以下のようなネットワーク/VMを構成します。
  - ※「T」＝ピアリングリンクの「リモート仮想ネットワークから転送されるトラフィック」設定

    ```
    vnet3: vm3(nic3, 10.63.0.4)
    ↑1to3(T:allow), ↓3to1(T:block)  
    vnet01: vm0(nic0[IP転送有効], 10.60.0.4, router) ,vm1(nic1)
    ↓1to2(T:allow), ↑2to1(T:block) 
    vnet2: vm2(nic2, 10.62.0.4)
    ```

- タスク3
  - ハブ(vnet01)からスポークへの通信が**可能**であることを確認します。

    ```
    vm0->10.62.0.4(vm2): ok
    vm0->10.63.0.4(vm3): ok
    ```

  - スポーク間(vnet2とvnet3)の通信が**不可能**であることを確認します。

    ```
    vm2->10.63.0.4(vm3): ng
    ```

- タスク4
  - ハブ(vnet01)のvm0のNICの「IP転送」を有効化します
  - vm0のWindowsにてルーティングロールサービス(パケット転送)を有効化します
  - スポーク間(vnet2とvnet3)の通信が**可能になった**ことを確認します。

    ```
    vm2->10.63.0.4(vm3): ok
    ```

## タスク1～4 補足事項

タスク1の5
リージョンはjapaneast
一連のコマンドは-AsJobを取って1つずつ確認しながら実施しましょう。

タスク3の5
2分以上時間がかかります。

タスク3の9
到達不能になるのでかなり時間がかかります。

タスク4の7
「コマンドの実行」→「実行コマンド」

## タスク5～タスク6 補足事項

次のラボ(ラボ6b)で実施しますので今回はスキップしてください。

## リソースをクリーン アップする

実施してください。
